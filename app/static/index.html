<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nomad Pi</title>
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="css/style.css?v=3">
</head>
<body>
    <div id="login-screen" class="login-container">
        <div class="login-box">
            <div class="logo">Nomad Pi ‚ú®</div>
            <p>Enter password to access your media</p>
            <input type="password" id="password-input" placeholder="Password (default: nomad)" onkeypress="handleLoginKey(event)">
            <button onclick="login()" class="primary">Enter</button>
            <p id="login-error" style="color: var(--danger-color); display:none;">Incorrect password</p>
        </div>
    </div>

    <div id="app" class="hidden">
        <header class="glass">
            <div class="logo">Nomad Pi ‚ú®</div>
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">‚ò∞</button>
            <nav id="main-nav">
                <button onclick="showSection('home')">Home</button>
                <button onclick="showSection('movies')">Movies</button>
                <button onclick="showSection('shows')">Shows</button>
                <button onclick="showSection('music')">Music</button>
                <button onclick="showSection('books')">Books</button>
                <button onclick="showSection('gallery')">Gallery</button>
                <button onclick="showSection('files')">Files</button>
                <button onclick="showSection('admin')">Admin</button>
                <button onclick="showSection('settings')">Settings</button>
                <span id="header-stats" class="header-stats"></span>
                <button onclick="logout()" class="logout-btn">Logout</button>
            </nav>
        </header>

        <main>
            <section id="home" class="active">
                <h1>Welcome Home</h1>
                <div class="stats-grid">
                    <div class="stat-card glass-hover">
                        <div class="stat-header">
                            <span class="stat-icon">üíæ</span>
                            <span class="stat-label">Storage</span>
                        </div>
                        <div id="storage-stats" class="stat-value">Loading...</div>
                        <div class="progress-container"><div id="disk-progress" class="progress-bar"></div></div>
                        <div id="disk-details" class="stat-details">Initializing...</div>
                    </div>
                    <div class="stat-card glass-hover">
                        <div class="stat-header">
                            <span class="stat-icon">üß†</span>
                            <span class="stat-label">CPU</span>
                        </div>
                        <div id="cpu-stats" class="stat-value">Loading...</div>
                        <div class="progress-container"><div id="cpu-progress" class="progress-bar"></div></div>
                        <div id="cpu-details" class="stat-details">Initializing...</div>
                    </div>
                    <div class="stat-card glass-hover">
                        <div class="stat-header">
                            <span class="stat-icon">‚ö°</span>
                            <span class="stat-label">RAM</span>
                        </div>
                        <div id="ram-stats" class="stat-value">Loading...</div>
                        <div class="progress-container"><div id="mem-progress" class="progress-bar"></div></div>
                        <div id="mem-details" class="stat-details">Initializing...</div>
                    </div>
                    <div class="stat-card glass-hover">
                        <div class="stat-header">
                            <span class="stat-icon">üå°Ô∏è</span>
                            <span class="stat-label">Temp</span>
                        </div>
                        <div id="cpu-temp" class="stat-value">--¬∞C</div>
                        <div id="temp-details" class="stat-details">Core Temperature</div>
                    </div>
                </div>
                
                <div class="menu-grid">
                    <div class="card" onclick="showSection('movies')">
                        <div class="icon">üé¨</div>
                        <h3>Movies</h3>
                    </div>
                    <div class="card" onclick="showSection('shows')">
                        <div class="icon">üì∫</div>
                        <h3>Shows</h3>
                    </div>
                    <div class="card" onclick="showSection('music')">
                        <div class="icon">üéµ</div>
                        <h3>Music</h3>
                    </div>
                    <div class="card" onclick="showSection('books')">
                         <div class="icon">üìö</div>
                        <h3>Books</h3>
                    </div>
                    <div class="card" onclick="showSection('gallery')">
                        <div class="icon">üñºÔ∏è</div>
                        <h3>Gallery</h3>
                    </div>
                    <div class="card" onclick="showSection('files')">
                        <div class="icon">üóÇÔ∏è</div>
                        <h3>Files</h3>
                    </div>
                    <div class="card" onclick="showSection('admin')">
                        <div class="icon">‚öôÔ∏è</div>
                        <h3>Admin</h3>
                    </div>
                    <div class="card" onclick="showSection('settings')">
                        <div class="icon">üîß</div>
                        <h3>Settings</h3>
                    </div>
                </div>

                <div id="resume-section" class="hidden">
                    <h2>Continue Watching</h2>
                    <div id="resume-list" class="media-grid"></div>
                </div>

                <div id="recent-section" class="hidden">
                    <h2>Recently Added</h2>
                    <div id="recent-list" class="media-grid"></div>
                </div>
            </section>


            <section id="movies" class="hidden">
                <h2>Movies</h2>
                <div class="filter-bar">
                    <input id="movies-search" type="text" placeholder="Search movies..." style="flex: 1; min-width: 200px;">
                    <select id="movies-sort" onchange="loadMovies(true)">
                        <option value="name">Sort: Name (A-Z)</option>
                        <option value="newest">Sort: Recently Added</option>
                        <option value="year_desc">Sort: Year (Newest)</option>
                        <option value="year_asc">Sort: Year (Oldest)</option>
                        <option value="top_watched">Sort: Most Watched</option>
                        <option value="recently_played">Sort: Recently Played</option>
                    </select>
                    <select id="movies-genre" onchange="loadMovies(true)">
                        <option value="">All Genres</option>
                    </select>
                    <select id="movies-year" onchange="loadMovies(true)">
                        <option value="">All Years</option>
                    </select>
                </div>
                <div id="movies-list" class="media-grid"></div>
            </section>

            <section id="shows" class="hidden">
                <h2>TV Shows</h2>
                <div class="filter-bar">
                    <input id="shows-search" type="text" placeholder="Search shows..." style="flex: 1; min-width: 200px;">
                    <select id="shows-sort" onchange="loadShows(true)">
                        <option value="name">Sort: Name (A-Z)</option>
                        <option value="newest">Sort: Recently Added</option>
                        <option value="top_watched">Sort: Most Watched</option>
                        <option value="recently_played">Sort: Recently Played</option>
                    </select>
                    <select id="shows-genre" onchange="loadShows(true)">
                        <option value="">All Genres</option>
                    </select>
                    <select id="shows-year" onchange="loadShows(true)">
                        <option value="">All Years</option>
                    </select>
                </div>
                <div id="shows-breadcrumb" style="margin:8px 0;color:#aaa;font-size:0.9em;"></div>
                <div id="shows-continue"></div>
                <div id="shows-list" class="media-grid"></div>
            </section>

            <section id="music" class="hidden">
                <h2>Music</h2>
                <input id="music-search" type="text" placeholder="Search music..." style="width:100%;margin:10px 0;padding:10px;border-radius:8px;border:1px solid var(--border-color);background:rgba(0,0,0,0.2);color:var(--text-color);">
                <div id="music-list" class="list-view"></div>
            </section>

            <section id="books" class="hidden">
                <h2>Books</h2>
                <input id="books-search" type="text" placeholder="Search books..." style="width:100%;margin:10px 0;padding:10px;border-radius:8px;border:1px solid var(--border-color);background:rgba(0,0,0,0.2);color:var(--text-color);">
                <div id="books-list" class="media-grid"></div>
            </section>

            <section id="gallery" class="hidden">
                <h2>Gallery</h2>
                <input id="gallery-search" type="text" placeholder="Search gallery..." style="width:100%;margin:10px 0;padding:10px;border-radius:8px;border:1px solid var(--border-color);background:rgba(0,0,0,0.2);color:var(--text-color);">
                <div id="gallery-list" class="gallery-grid"></div>
            </section>

            <section id="files" class="hidden">
                <h2>Files</h2>
                <input id="files-search" type="text" placeholder="Search files..." style="width:100%;margin:10px 0;padding:10px;border-radius:8px;border:1px solid var(--border-color);background:rgba(0,0,0,0.2);color:var(--text-color);">
                <div id="files-list" class="list-view"></div>
            </section>

            <section id="admin" class="hidden">
                <h2>Admin & Uploads</h2>
                
                <div class="admin-panel">
                    <h3>System Control</h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="rebuildLibrary()" class="primary">Scan Library for Changes</button>
                        <button onclick="systemControl('update')" class="primary">Update from GitHub</button>
                        <button onclick="systemControl('reboot')" class="warning">Reboot Device</button>
                        <button onclick="systemControl('shutdown')" class="danger">Shutdown Device</button>
                    </div>
                    
                    <h4 style="margin-top:20px; margin-bottom:10px;">Wi-Fi Control</h4>
                    <div class="wifi-controls-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 20px;">
                        <button id="wifi-toggle-btn" onclick="toggleWifiUI()" class="primary">Checking Wi-Fi...</button>
                        <button onclick="systemControl('wifi_restart')" class="warning">Restart Wi-Fi</button>
                        <button onclick="scanWifi()" class="secondary">Scan Networks</button>
                    </div>
                    
                    <div id="wifi-status-info" class="glass" style="padding:12px 20px; border-radius:12px; margin-bottom:15px; display:flex; align-items:center; gap:12px;">
                        <div id="wifi-status-icon" style="font-size:1.5em;">üì°</div>
                        <div>
                            <div id="wifi-status-text" style="font-weight:bold;">Status: Unknown</div>
                            <div id="wifi-connection-details" style="font-size:0.85em; color:var(--text-muted);">Initializing...</div>
                        </div>
                    </div>

                    <div id="wifi-scan-container" class="hidden animate-fade" style="margin-top:15px; padding:20px; background:rgba(0,0,0,0.4); border-radius:16px; border:1px solid var(--border-color); box-shadow: var(--shadow-md);">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                            <h3 style="margin:0; font-size:1.1em; display:flex; align-items:center; gap:8px;">
                                <span style="font-size:1.2em;">üì∂</span> Available Networks
                            </h3>
                            <button onclick="scanWifi()" class="secondary" style="padding: 6px 12px; font-size: 0.85em; border-radius:8px;">
                                <span>üîÑ</span> Refresh
                            </button>
                        </div>
                        <div id="wifi-networks-list" style="display:flex; flex-direction:column; gap:10px; max-height:350px; overflow-y:auto; padding-right:5px;">
                            <!-- Networks will be listed here -->
                        </div>
                    </div>

                    <!-- Modern Modal for Password -->
                    <div id="wifi-modal" class="hidden" style="position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.8); backdrop-filter:blur(8px); z-index:1000; display:flex; align-items:center; justify-content:center; padding:20px;">
                        <div class="glass animate-fade" style="width:100%; max-width:400px; padding:30px; border-radius:24px; box-shadow:var(--shadow-lg);">
                            <h3 id="modal-title" style="margin-top:0; margin-bottom:10px;">Connect to Network</h3>
                            <p id="modal-ssid" style="color:var(--text-muted); margin-bottom:20px;"></p>
                            
                            <div style="margin-bottom:20px;">
                                <label style="display:block; margin-bottom:8px; font-size:0.9em; color:var(--text-muted);">Password</label>
                                <input type="password" id="wifi-password-input" placeholder="Enter network password" 
                                    style="width:100%; padding:12px 16px; background:rgba(255,255,255,0.05); border:1px solid var(--border-color); border-radius:12px; color:white; font-size:1em;">
                            </div>
                            
                            <div style="display:flex; gap:12px;">
                                <button onclick="closeWifiModal()" class="secondary" style="flex:1; padding:12px; border-radius:12px;">Cancel</button>
                                <button id="modal-connect-btn" class="primary" style="flex:2; padding:12px; border-radius:12px;">Connect</button>
                            </div>
                        </div>
                    </div>

                    <div id="update-log-container" class="hidden" style="margin-top:15px; padding:10px; background:rgba(0,0,0,0.4); border-radius:8px; border:1px solid var(--border-color);">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <h4 style="margin:0;">Update Progress</h4>
                            <span id="update-status-badge" class="badge">Running...</span>
                        </div>
                        <pre id="update-log-view" style="max-height:200px; overflow-y:auto; font-size:0.85em; margin:0; white-space:pre-wrap; font-family:monospace;"></pre>
                    </div>
                </div>

                <div class="admin-panel">
                    <h3>Upload Files</h3>
                    <div class="upload-controls">
                        <label>Category:</label>
                        <select id="upload-category">
                            <option value="movies">Movies</option>
                            <option value="shows">Shows</option>
                            <option value="music">Music</option>
                            <option value="books">Books</option>
                            <option value="gallery">Gallery</option>
                            <option value="files">Files</option>
                        </select>
                        <br><br>

                        <div id="shows-upload-options" class="hidden" style="margin-bottom:10px;">
                            <label for="upload-show-name">Show name (optional):</label>
                            <input id="upload-show-name" type="text" placeholder="e.g. Bluey" style="width:100%;margin:8px 0;padding:10px;border-radius:8px;border:1px solid var(--border-color);background:rgba(0,0,0,0.2);color:var(--text-color);">
                            <div style="color:var(--text-muted); font-size:0.85rem;">Helps keep seasons grouped under the right show.</div>
                        </div>
                        
                        <div class="drop-zone" id="drop-zone">
                            <p>Drag & drop files or folders here</p>
                            <input type="file" id="file-input" multiple>
                            <label for="file-input" class="button">Select Files</label>
                            
                            <input type="file" id="folder-input" webkitdirectory directory multiple style="display:none">
                            <label for="folder-input" class="button">Select Folder</label>
                        </div>

                        <div id="upload-queue" style="margin-top:10px; max-height: 150px; overflow-y: auto;"></div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button id="start-upload-btn" onclick="uploadFiles()" class="primary" style="margin-top:10px; flex-grow: 1;">Start Upload</button>
                            <button id="cancel-upload-btn" onclick="cancelUpload()" class="danger hidden" style="margin-top:10px; flex-grow: 0;">Cancel</button>
                        </div>
                    </div>
                    <div id="upload-status"></div>
                </div>

                <div class="admin-panel">
                    <h3>Storage Management</h3>
                    <button onclick="loadDrives()">Scan Drives</button>
                    <div id="drive-list"></div>
                </div>

                <div class="admin-panel">
                    <h3>Library Tools (v1.1)</h3>
                    <button onclick="rescanLibrary()">Rescan Library</button>
                    <button onclick="organizeShows(true)">Preview Show Organize</button>
                    <button onclick="organizeShows(false)" class="warning">Apply Show Organize</button>
                    <button onclick="organizeMovies(true)">Preview Movie Organize</button>
                    <button onclick="organizeMovies(false)" class="warning">Apply Movie Organize</button>
                    <div id="organize-status" style="margin-top:10px;"></div>
                </div>
            </section>

            <section id="settings" class="hidden">
                <h2>Settings</h2>
                <div class="admin-panel">
                    <h3>Account Security</h3>
                    <div class="settings-form">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px;">Current Password</label>
                            <input type="password" id="change-pw-current" style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--border-color); background:rgba(0,0,0,0.2); color:var(--text-color);">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px;">New Password</label>
                            <input type="password" id="change-pw-new" style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--border-color); background:rgba(0,0,0,0.2); color:var(--text-color);">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px;">Confirm New Password</label>
                            <input type="password" id="change-pw-confirm" style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--border-color); background:rgba(0,0,0,0.2); color:var(--text-color);">
                        </div>
                        <button onclick="changePassword()" class="primary">Update Password</button>
                        <p id="change-pw-status" style="margin-top:10px; font-size:0.9em;"></p>
                    </div>
                </div>

                <div class="admin-panel">
                    <h3>General Settings</h3>
                    <div class="settings-form">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px;">Server Name</label>
                            <input type="text" id="setting-server-name" placeholder="Nomad Pi" style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--border-color); background:rgba(0,0,0,0.2); color:var(--text-color);">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px;">Session Expiry (Days)</label>
                            <input type="number" id="setting-session-days" value="30" style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--border-color); background:rgba(0,0,0,0.2); color:var(--text-color);">
                        </div>
                        <button onclick="saveSettings()" class="primary">Save Settings</button>
                    </div>
                </div>
                
                <div class="admin-panel">
                    <h3>Appearance</h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="setTheme('dark')" class="secondary">Dark Theme</button>
                        <button onclick="setTheme('glass')" class="secondary">Glassmorphism</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div id="viewer-modal" class="modal hidden">
        <div class="modal-backdrop" onclick="closeViewer()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <div id="viewer-title" class="modal-title"></div>
                <button class="modal-close" onclick="closeViewer()">Close</button>
            </div>
            <div id="viewer-body" class="modal-body"></div>
        </div>
    </div>

    <div id="player-bar" class="player-bar glass hidden">
        <div class="player-title" id="player-title">Not playing</div>
        <div class="player-controls">
            <button id="player-prev" class="player-btn" title="Previous">‚èÆ</button>
            <button id="player-play" class="player-btn" title="Play/Pause">‚ñ∂</button>
            <button id="player-next" class="player-btn" title="Next">‚è≠</button>
            <button id="player-shuffle" class="player-btn" title="Shuffle">üîÄ</button>
        </div>
        <div class="player-progress">
            <input id="player-seek" type="range" min="0" max="100" value="0">
            <div id="player-time" class="player-time">0:00 / 0:00</div>
        </div>
        <div class="player-volume">
            <span style="font-size: 0.8rem; margin-right: 5px;">üîä</span>
            <input id="player-volume" type="range" min="0" max="1" step="0.01" value="1">
        </div>
        <audio id="global-audio" preload="auto"></audio>
    </div>
    <div id="toast-container"></div>
    <script src="js/app.js?v=6"></script>
</body>
</html>
