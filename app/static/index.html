<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Nomad Pi</title>
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="css/style.css?v=1768131100">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Nomad Pi">
    <link rel="apple-touch-icon" href="icons/icon-512.svg">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Nomad Pi">
    <meta name="msapplication-TileColor" content="#0f172a">
    <meta name="msapplication-tap-highlight" content="no">
</head>
<body>
    <div id="login-screen" class="login-container">
        <div class="login-box">
            <div class="logo">Nomad Pi ‚ú®</div>
            <p>Sign in to access your media</p>
            <input type="text" id="username-input" placeholder="Username" value="admin" onkeypress="handleLoginKey(event)" style="margin-bottom: 10px;">
            <input type="password" id="password-input" placeholder="Password" onkeypress="handleLoginKey(event)">
            <button onclick="login()" class="primary">Enter</button>
            <p id="login-error" style="color: var(--danger-color); display:none;">Incorrect username or password</p>
            <p id="setup-hint" style="color: var(--text-muted); font-size: 0.9em; margin-top: 10px; display:none;"></p>
        </div>
    </div>

    <div id="app" class="hidden">
        <header class="glass">
            <div class="logo">Nomad Pi ‚ú®</div>
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">‚ò∞</button>
            <nav id="main-nav">
                <button onclick="event.stopPropagation(); showSection('home')" class="active"><i class="fas fa-home"></i> Home</button>
                <button onclick="event.stopPropagation(); showSection('movies')"><i class="fas fa-film"></i> Movies</button>
                <button onclick="event.stopPropagation(); showSection('shows')"><i class="fas fa-tv"></i> Shows</button>
                <button onclick="event.stopPropagation(); showSection('music')"><i class="fas fa-music"></i> Music</button>
                <button onclick="event.stopPropagation(); showSection('books')"><i class="fas fa-book"></i> Books</button>
                <button onclick="event.stopPropagation(); showSection('gallery')"><i class="fas fa-image"></i> Gallery</button>
                <button onclick="event.stopPropagation(); showSection('files')"><i class="fas fa-folder-open"></i> Files</button>
                <button onclick="event.stopPropagation(); showSection('admin')"><i class="fas fa-user-shield"></i> Admin</button>
                <button onclick="event.stopPropagation(); showSection('settings')"><i class="fas fa-cog"></i> Settings</button>
                <span id="header-stats" class="header-stats"></span>
                <button onclick="event.stopPropagation(); logout()" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </nav>
        </header>

        <nav class="mobile-bottom-nav glass">
            <button onclick="showSection('home')" id="btn-home-mob" class="nav-item active">
                <span class="nav-icon"><i class="fas fa-home"></i></span>
                <span class="nav-label">Home</span>
            </button>
            <button onclick="showSection('movies')" id="btn-movies-mob" class="nav-item">
                <span class="nav-icon"><i class="fas fa-film"></i></span>
                <span class="nav-label">Movies</span>
            </button>
            <button onclick="showSection('shows')" id="btn-shows-mob" class="nav-item">
                <span class="nav-icon"><i class="fas fa-tv"></i></span>
                <span class="nav-label">Shows</span>
            </button>
            <button onclick="showSection('files')" id="btn-files-mob" class="nav-item">
                <span class="nav-icon"><i class="fas fa-folder-open"></i></span>
                <span class="nav-label">Files</span>
            </button>
            <button onclick="toggleMobileMenu()" id="btn-more-mob" class="nav-item">
                <span class="nav-icon"><i class="fas fa-bars"></i></span>
                <span class="nav-label">More</span>
            </button>
        </nav>

        <main>
            <section id="home" class="active">
                <h1>Welcome Home</h1>
                <div class="stats-grid">
                    <div class="stat-card glass-hover">
                        <div class="stat-header">
                            <span class="stat-icon"><i class="fas fa-hdd"></i></span>
                            <span class="stat-label">Storage</span>
                        </div>
                        <div id="storage-stats" class="stat-value">Loading...</div>
                        <div class="progress-container"><div id="disk-progress" class="progress-bar"></div></div>
                        <div id="disk-details" class="stat-details">Initializing...</div>
                    </div>
                    <div class="stat-card glass-hover">
                        <div class="stat-header">
                            <span class="stat-icon"><i class="fas fa-microchip"></i></span>
                            <span class="stat-label">CPU</span>
                        </div>
                        <div id="cpu-stats" class="stat-value">Loading...</div>
                        <div class="progress-container"><div id="cpu-progress" class="progress-bar"></div></div>
                        <div id="cpu-details" class="stat-details">Initializing...</div>
                    </div>
                    <div class="stat-card glass-hover">
                        <div class="stat-header">
                            <span class="stat-icon"><i class="fas fa-memory"></i></span>
                            <span class="stat-label">RAM</span>
                        </div>
                        <div id="ram-stats" class="stat-value">Loading...</div>
                        <div class="progress-container"><div id="mem-progress" class="progress-bar"></div></div>
                        <div id="mem-details" class="stat-details">Initializing...</div>
                    </div>
                    <div class="stat-card glass-hover">
                        <div class="stat-header">
                            <span class="stat-icon"><i class="fas fa-thermometer-half"></i></span>
                            <span class="stat-label">Temp</span>
                        </div>
                        <div id="cpu-temp" class="stat-value">--¬∞C</div>
                        <div id="temp-details" class="stat-details">Core Temperature</div>
                    </div>
                </div>
                
                <div class="menu-grid">
                    <div class="card glass-hover" onclick="showSection('movies')">
                        <div class="icon"><i class="fas fa-film"></i></div>
                        <h3>Movies</h3>
                    </div>
                    <div class="card glass-hover" onclick="showSection('shows')">
                        <div class="icon"><i class="fas fa-tv"></i></div>
                        <h3>Shows</h3>
                    </div>
                    <div class="card glass-hover" onclick="showSection('music')">
                        <div class="icon"><i class="fas fa-music"></i></div>
                        <h3>Music</h3>
                    </div>
                    <div class="card glass-hover" onclick="showSection('books')">
                         <div class="icon"><i class="fas fa-book"></i></div>
                        <h3>Books</h3>
                    </div>
                    <div class="card glass-hover" onclick="showSection('gallery')">
                        <div class="icon"><i class="fas fa-image"></i></div>
                        <h3>Gallery</h3>
                    </div>
                    <div class="card glass-hover" onclick="showSection('files')">
                        <div class="icon"><i class="fas fa-folder-open"></i></div>
                        <h3>Files</h3>
                    </div>
                    <div class="card glass-hover" onclick="showSection('admin')">
                        <div class="icon"><i class="fas fa-user-shield"></i></div>
                        <h3>Admin</h3>
                    </div>
                    <div class="card glass-hover" onclick="showSection('settings')">
                        <div class="icon"><i class="fas fa-cog"></i></div>
                        <h3>Settings</h3>
                    </div>
                </div>

                <div id="resume-section" class="hidden">
                    <h2>Continue Watching</h2>
                    <div id="resume-list" class="media-grid"></div>
                </div>

                <div id="up-next-section" class="hidden">
                    <h2>Up Next</h2>
                    <div id="up-next-list" class="media-grid"></div>
                </div>

                <div id="recent-section" class="hidden">
                    <h2>Recently Added</h2>
                    <div id="recent-list" class="media-grid"></div>
                </div>
            </section>


            <section id="movies" class="hidden">
                <h2>Movies</h2>
                <div id="movies-filter-bar" class="filter-bar">
                    <input id="movies-search" type="text" placeholder="Search movies..." style="flex: 1; min-width: 200px;">
                    <select id="movies-sort" onchange="loadMovies(true)">
                        <option value="name">Sort: Name (A-Z)</option>
                        <option value="newest">Sort: Recently Added</option>
                        <option value="year_desc">Sort: Year (Newest)</option>
                        <option value="year_asc">Sort: Year (Oldest)</option>
                        <option value="top_watched">Sort: Most Watched</option>
                        <option value="recently_played">Sort: Recently Played</option>
                    </select>
                    <select id="movies-genre" onchange="loadMovies(true)">
                        <option value="">All Genres</option>
                    </select>
                    <select id="movies-year" onchange="loadMovies(true)">
                        <option value="">All Years</option>
                    </select>
                </div>
                <div id="movies-list" class="media-grid"></div>
            </section>

            <section id="shows" class="hidden">
                <h2>TV Shows</h2>
                <div id="shows-filter-bar" class="filter-bar">
                    <input id="shows-search" type="text" placeholder="Search shows..." style="flex: 1; min-width: 200px;">
                    <select id="shows-sort" onchange="loadShows(true)">
                        <option value="name">Sort: Name (A-Z)</option>
                        <option value="newest">Sort: Recently Added</option>
                        <option value="top_watched">Sort: Most Watched</option>
                        <option value="recently_played">Sort: Recently Played</option>
                    </select>
                    <select id="shows-genre" onchange="loadShows(true)">
                        <option value="">All Genres</option>
                    </select>
                    <select id="shows-year" onchange="loadShows(true)">
                        <option value="">All Years</option>
                    </select>
                </div>
                <div id="shows-breadcrumb" style="margin:8px 0;color:#aaa;font-size:0.9em;"></div>
                <div id="shows-continue"></div>
                <div id="shows-list" class="media-grid"></div>
            </section>

            <section id="music" class="hidden">
                <h2>Music</h2>
                <input id="music-search" type="text" placeholder="Search music..." style="width:100%;margin:10px 0;padding:10px;border-radius:8px;border:1px solid var(--border-color);background:rgba(0,0,0,0.2);color:var(--text-color);">
                <div id="music-list" class="list-view"></div>
            </section>

            <section id="books" class="hidden">
                <h2>Books</h2>
                <input id="books-search" type="text" placeholder="Search books..." style="width:100%;margin:10px 0;padding:10px;border-radius:8px;border:1px solid var(--border-color);background:rgba(0,0,0,0.2);color:var(--text-color);">
                <div id="books-list" class="media-grid"></div>
            </section>

            <section id="gallery" class="hidden">
                <h2>Gallery</h2>
                <input id="gallery-search" type="text" placeholder="Search gallery..." style="width:100%;margin:10px 0;padding:10px;border-radius:8px;border:1px solid var(--border-color);background:rgba(0,0,0,0.2);color:var(--text-color);">
                <div id="gallery-list" class="gallery-grid"></div>
            </section>

            <section id="files" class="hidden">
                <h2>Files</h2>
                <input id="files-search" type="text" placeholder="Search files..." style="width:100%;margin:10px 0;padding:10px;border-radius:8px;border:1px solid var(--border-color);background:rgba(0,0,0,0.2);color:var(--text-color);">
                <div id="files-list" class="list-view"></div>
            </section>

            <section id="admin" class="hidden">
                <h2>Admin & Uploads</h2>
                
                <div class="admin-panel">
                    <h3>System Control</h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="rebuildLibrary()" class="primary">Scan Library for Changes</button>
                        <button onclick="fixDuplicates()" class="primary">Mass Fix Duplicates</button>
                        <button onclick="systemControl('update')" class="primary">Update from GitHub</button>
                        <button onclick="systemControl('reboot')" class="warning">Reboot Device</button>
                        <button onclick="systemControl('shutdown')" class="danger">Shutdown Device</button>
                    </div>
                    
                    <h4 style="margin-top:20px; margin-bottom:10px;">Wi-Fi Control</h4>
                    <div class="wifi-controls-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 20px;">
                        <button id="wifi-toggle-btn" onclick="toggleWifiUI()" class="primary">Checking Wi-Fi...</button>
                        <button onclick="systemControl('wifi_restart')" class="warning">Restart Wi-Fi</button>
                        <button onclick="scanWifi()" class="secondary">Scan Networks</button>
                    </div>

                    <h4 style="margin-top:20px; margin-bottom:10px;">Tailscale VPN</h4>
                    <div id="tailscale-panel" style="margin-bottom: 20px;">
                        <div id="ts-loading" style="color:var(--text-muted);">Loading Tailscale status...</div>
                        <div id="ts-content" style="display:none;">
                            <div style="margin-bottom: 15px; display:flex; align-items:center; gap:15px; flex-wrap:wrap;">
                                <div>
                                    <span style="color:var(--text-muted); margin-right:5px;">Status:</span>
                                    <span id="ts-status-badge" style="padding:4px 10px; border-radius:12px; font-weight:bold; font-size:0.9rem;">Unknown</span>
                                </div>
                                <div id="ts-ip-container" style="display:none;">
                                    <span style="color:var(--text-muted); margin-right:5px;">IP:</span>
                                    <code id="ts-ip" style="background:rgba(255,255,255,0.1); padding:4px 8px; border-radius:4px; font-family:monospace;"></code>
                                </div>
                            </div>

                            <div id="ts-auth-section" style="margin-bottom:15px; display:none;">
                                <label style="display:block; margin-bottom:5px; font-size:0.9rem;">Auth Key (if required):</label>
                                <div style="display:flex; gap:10px;">
                                    <input type="password" id="ts-auth-key" placeholder="tskey-auth-..." style="flex:1; padding:8px 12px; border-radius:8px; border:1px solid var(--border-color); background:rgba(0,0,0,0.2); color:var(--text-color);">
                                    <button onclick="saveTsKey()" class="secondary" style="padding:8px 15px;">Save</button>
                                </div>
                            </div>

                            <div style="display:flex; gap:10px; flex-wrap:wrap;">
                                <button id="btn-ts-connect" onclick="connectTailscale()" class="primary">Connect</button>
                                <button id="btn-ts-disconnect" onclick="disconnectTailscale()" class="warning" style="display:none;">Disconnect</button>
                                <button onclick="checkTailscale()" class="secondary">Refresh</button>
                            </div>
                            <div id="ts-message" style="margin-top:10px; font-size:0.9rem; color:var(--text-muted);"></div>
                        </div>
                    </div>
                    
                    <div id="wifi-status-info" class="glass" style="padding:12px 20px; border-radius:12px; margin-bottom:15px; display:flex; align-items:center; gap:12px;">
                        <div id="wifi-status-icon" style="font-size:1.5em;">üì°</div>
                        <div>
                            <div id="wifi-status-text" style="font-weight:bold;">Status: Unknown</div>
                            <div id="wifi-connection-details" style="font-size:0.85em; color:var(--text-muted);">Initializing...</div>
                        </div>
                    </div>

                    <div id="wifi-scan-container" class="hidden animate-fade wifi-container glass-card">
                        <div class="wifi-header">
                            <h3 class="wifi-title">
                                <i class="fas fa-wifi"></i> Available Networks
                            </h3>
                            <button onclick="scanWifi()" class="secondary btn-sm">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                        <div id="wifi-networks-list" class="wifi-list">
                            <!-- Networks will be listed here -->
                        </div>
                    </div>

                    <!-- Modern Modal for Password -->
                    <div id="wifi-modal" class="hidden wifi-modal-overlay">
                        <div class="glass-modal animate-fade">
                            <h3 id="modal-title">Connect to Network</h3>
                            <p id="modal-ssid" class="modal-subtitle"></p>
                            
                            <div class="form-group">
                                <label>Password</label>
                                <input type="password" id="wifi-password-input" placeholder="Enter network password">
                            </div>
                            
                            <div class="modal-footer">
                                <button onclick="closeWifiModal()" class="secondary">Cancel</button>
                                <button id="modal-connect-btn" class="primary">Connect</button>
                            </div>
                        </div>
                    </div>

                    <div id="update-log-container" class="hidden update-container glass-card">
                        <div class="update-header">
                            <h4 class="update-title"><i class="fas fa-download"></i> Update Progress</h4>
                            <span id="update-status-badge" class="badge">Running...</span>
                        </div>
                        <div class="progress-wrapper">
                            <div class="progress-bar">
                                <div id="update-progress-fill" class="progress-fill" style="width: 0%"></div>
                            </div>
                            <div id="update-progress-text" class="progress-text">Initializing...</div>
                        </div>
                        <pre id="update-log-view" class="update-log"></pre>
                    </div>
                </div>

                <div class="admin-panel">
                    <h3>Upload Files</h3>
                    <div class="upload-controls">
                        <label>Category:</label>
                        <select id="upload-category">
                            <option value="movies">Movies</option>
                            <option value="shows">Shows</option>
                            <option value="music">Music</option>
                            <option value="books">Books</option>
                            <option value="gallery">Gallery</option>
                            <option value="files">Files</option>
                        </select>
                        <br><br>

                        <div id="shows-upload-options" class="hidden" style="margin-bottom:10px;">
                            <label for="upload-show-name">Show name (optional):</label>
                            <input id="upload-show-name" type="text" placeholder="e.g. Bluey" style="width:100%;margin:8px 0;padding:10px;border-radius:8px;border:1px solid var(--border-color);background:rgba(0,0,0,0.2);color:var(--text-color);">
                            <div style="color:var(--text-muted); font-size:0.85rem;">Helps keep seasons grouped under the right show.</div>
                        </div>
                        
                        <div class="drop-zone" id="drop-zone">
                            <p>Drag & drop files or folders here</p>
                            <input type="file" id="file-input" multiple>
                            <label for="file-input" class="button">Select Files</label>
                            
                            <input type="file" id="folder-input" webkitdirectory directory multiple style="display:none">
                            <label for="folder-input" class="button">Select Folder</label>
                        </div>

                        <div id="upload-queue" style="margin-top:10px; max-height: 150px; overflow-y: auto;"></div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button id="start-upload-btn" onclick="uploadFiles()" class="primary" style="margin-top:10px; flex-grow: 1;">Start Upload</button>
                            <button id="cancel-upload-btn" onclick="cancelUpload()" class="danger hidden" style="margin-top:10px; flex-grow: 0;">Cancel</button>
                        </div>
                    </div>
                    <div id="upload-status"></div>
                </div>

                <div class="admin-panel">
                    <h3>User Management</h3>
                    <div id="user-management-list" class="list-view" style="margin-bottom: 20px;">
                        <!-- Users will be listed here -->
                        <div class="loading">Loading users...</div>
                    </div>
                    
                    <h4>Add New User</h4>
                    <div class="form-grid" style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; align-items: end;">
                        <div class="form-group">
                            <label>Username</label>
                            <input type="text" id="new-user-username" placeholder="Username">
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="new-user-password" placeholder="Password">
                        </div>
                        <div class="form-group">
                            <label style="display: block; margin-bottom: 5px;">Admin</label>
                            <input type="checkbox" id="new-user-is-admin" style="width: auto; height: auto;">
                        </div>
                        <button onclick="addUser()" class="primary" style="grid-column: span 3;">Create User</button>
                    </div>
                </div>

                <div class="admin-panel">
                    <h3>Storage Management</h3>
                    <button onclick="loadDrives()">Scan Drives</button>
                    <div id="drive-list"></div>
                </div>

                <div class="admin-panel">
                    <h3>Library Tools (v1.1)</h3>
                    <button onclick="rescanLibrary()">Rescan Library</button>
                    <label style="display:flex; align-items:center; gap:8px; margin:10px 0; color:var(--text-muted); font-size:0.9rem;">
                        <input type="checkbox" id="show-organize-rename-files" style="width:auto; height:auto;">
                        Rename episodes to SxxEyy (optional)
                    </label>
                    <button onclick="organizeShows(true)">Preview Show Organize</button>
                    <button onclick="organizeShows(false)" class="warning">Apply Show Organize</button>
                    <button onclick="organizeMovies(true)">Preview Movie Organize</button>
                    <button onclick="organizeMovies(false)" class="warning">Apply Movie Organize</button>
                    <div id="organize-status" style="margin-top:10px;"></div>
                </div>

                <div class="admin-panel">
                    <h3>Smart Media Management</h3>
                    <p style="color:var(--text-muted); font-size:0.85rem; margin-bottom:10px;">Identify duplicate files and content across your library.</p>
                    <button onclick="findDuplicates()" class="primary">Find Duplicates</button>
                    <div id="duplicates-status" style="margin-top:10px;"></div>
                </div>
            </section>

            <section id="settings" class="hidden">
                <h2>Settings</h2>
                
                <div class="admin-panel">
                    <h3>Your Profile</h3>
                    <div class="settings-form">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px;">Display Name</label>
                            <input type="text" id="profile-name" placeholder="How you want to be called" style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--border-color); background:rgba(0,0,0,0.2); color:var(--text-color);">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px;">Avatar URL (optional)</label>
                            <input type="text" id="profile-avatar" placeholder="https://..." style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--border-color); background:rgba(0,0,0,0.2); color:var(--text-color);">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px;">Parental Controls Level</label>
                            <select id="profile-parental" style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--border-color); background:rgba(0,0,0,0.2); color:var(--text-color);">
                                <option value="0">All Access</option>
                                <option value="1">Level 1 (Kids)</option>
                                <option value="2">Level 2 (Teens)</option>
                                <option value="3">Level 3 (Restricted)</option>
                            </select>
                        </div>
                        <button onclick="saveProfileUI()" class="primary">Update Profile</button>
                    </div>
                </div>

                <div class="admin-panel">
                    <h3>Account Security</h3>
                    <div class="settings-form">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px;">Current Password</label>
                            <input type="password" id="change-pw-current" style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--border-color); background:rgba(0,0,0,0.2); color:var(--text-color);">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px;">New Password</label>
                            <input type="password" id="change-pw-new" style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--border-color); background:rgba(0,0,0,0.2); color:var(--text-color);">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px;">Confirm New Password</label>
                            <input type="password" id="change-pw-confirm" style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--border-color); background:rgba(0,0,0,0.2); color:var(--text-color);">
                        </div>
                        <p id="change-pw-status" style="margin-bottom: 10px; font-size: 0.9em;"></p>
                        <button onclick="changePassword()" class="primary">Update Password</button>
                    </div>
                </div>

                <div class="admin-panel">
                    <h3>Metadata Configuration</h3>
                    <div class="settings-form">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px;">OMDb API Key</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="omdb-api-key" placeholder="Enter OMDb API Key" style="flex: 1; padding:10px; border-radius:8px; border:1px solid var(--border-color); background:rgba(0,0,0,0.2); color:var(--text-color);">
                                <button onclick="saveOmdbKey()" class="primary">Save Key</button>
                            </div>
                            <p style="color:var(--text-muted); font-size:0.85rem; margin-top:5px;">Used for fetching movie/show posters and metadata. Get one at omdbapi.com</p>
                        </div>
                    </div>
                </div>

                <div class="admin-panel">
                    <h3>Interface Settings</h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="toggleTheme()" class="secondary">Toggle Dark/Light Mode</button>
                        <button onclick="toggleGlassEffect()" class="secondary">Toggle Glass Effect</button>
                        <button id="install-pwa-btn" onclick="installPWA()" class="primary hidden">‚ú® Install Nomad Pi App</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div id="viewer-modal" class="modal hidden">
        <div class="modal-backdrop" onclick="closeViewer()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <div id="viewer-title" class="modal-title"></div>
                <button class="modal-close" onclick="closeViewer()">Close</button>
            </div>
            <div id="viewer-body" class="modal-body"></div>
        </div>
    </div>

    <div id="player-bar" class="player-bar glass hidden">
        <div class="player-title" id="player-title">Not playing</div>
        <div class="player-controls">
            <button id="player-prev" class="player-btn" title="Previous">‚èÆ</button>
            <button id="player-play" class="player-btn" title="Play/Pause">‚ñ∂</button>
            <button id="player-next" class="player-btn" title="Next">‚è≠</button>
            <button id="player-shuffle" class="player-btn" title="Shuffle">üîÄ</button>
            <button id="player-close" class="player-btn" title="Close Player">‚úï</button>
        </div>
        <div class="player-progress">
            <input id="player-seek" type="range" min="0" max="100" value="0">
            <div id="player-time" class="player-time">0:00 / 0:00</div>
        </div>
        <div class="player-volume">
            <span style="font-size: 0.8rem; margin-right: 5px;">üîä</span>
            <input id="player-volume" type="range" min="0" max="1" step="0.01" value="1">
        </div>
        <audio id="global-audio" preload="auto"></audio>
    </div>
    <div id="what-is-new-modal" class="modal hidden">
        <div class="modal-backdrop" onclick="closeWhatIsNew()"></div>
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <div class="modal-title">‚ú® Update Successful!</div>
                <button class="modal-close" onclick="closeWhatIsNew()">Close</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">üöÄ</div>
                    <h3 style="margin: 0;">Nomad Pi <span id="new-version-tag">v1.1.5</span></h3>
                    <p style="color: var(--text-muted);">Your system has been updated to the latest version.</p>
                </div>
                
                <h4 style="margin-bottom: 10px; border-bottom: 1px solid var(--border-color); padding-bottom: 5px;">What's New</h4>
                <ul id="changelog-list" style="padding-left: 20px; line-height: 1.6;">
                    <!-- Changelog items will be injected here -->
                </ul>
                
                <div style="margin-top: 25px; text-align: center;">
                    <button onclick="closeWhatIsNew()" class="primary" style="padding: 12px 30px;">Great, let's go!</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Welcome Screen Modal -->
    <div id="welcome-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <div class="modal-title">Welcome to Nomad Pi! üéâ</div>
                <button class="modal-close" onclick="closeWelcome()">√ó</button>
            </div>
            <div class="modal-body" style="padding: 30px;">
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="font-size: 4rem; margin-bottom: 15px;">‚ú®</div>
                    <h2 style="margin: 0 0 10px 0;">Your Personal Media Server is Ready!</h2>
                    <p style="color: var(--text-muted); font-size: 1.05rem;">Let's take a quick tour of what Nomad Pi can do for you</p>
                </div>

                <div class="welcome-features">
                    <div class="welcome-feature">
                        <div class="welcome-icon">üé¨</div>
                        <div class="welcome-content">
                            <h3>Movies & TV Shows</h3>
                            <p>Automatically organized with posters, metadata, and resume playback. Just drop your files and we'll handle the rest!</p>
                        </div>
                    </div>

                    <div class="welcome-feature">
                        <div class="welcome-icon">üìÇ</div>
                        <div class="welcome-content">
                            <h3>Easy File Management</h3>
                            <p>Upload files via the web, access via Samba at <code>\\nomadpi.local\data</code>, or plug in a USB drive.</p>
                        </div>
                    </div>

                    <div class="welcome-feature">
                        <div class="welcome-icon">üì°</div>
                        <div class="welcome-content">
                            <h3>Built-in Wi-Fi Hotspot</h3>
                            <p>Can't connect to your network? Nomad Pi creates a hotspot called <strong>NomadPi</strong> (password: <code>nomadpassword</code>).</p>
                        </div>
                    </div>

                    <div class="welcome-feature">
                        <div class="welcome-icon">üì∫</div>
                        <div class="welcome-content">
                            <h3>DLNA Smart TV Streaming</h3>
                            <p>Your smart TV can discover and play your media automatically via MiniDLNA‚Äîno apps needed!</p>
                        </div>
                    </div>

                    <div class="welcome-feature">
                        <div class="welcome-icon">üéµ</div>
                        <div class="welcome-content">
                            <h3>Music, Books & Gallery</h3>
                            <p>Full library support for music playback, PDF/EPUB/Comic readers, and photo galleries.</p>
                        </div>
                    </div>

                    <div class="welcome-feature">
                        <div class="welcome-icon">üîß</div>
                        <div class="welcome-content">
                            <h3>One-Click Updates</h3>
                            <p>Head to <strong>Admin ‚Üí Update from GitHub</strong> to always stay up to date with the latest features.</p>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 30px; padding: 20px; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px;">
                    <h4 style="margin: 0 0 10px 0; color: var(--accent-color);">üöÄ Quick Start Tips</h4>
                    <ul style="margin: 0; padding-left: 20px; line-height: 1.8;">
                        <li>Start by adding media in the <strong>Admin</strong> section</li>
                        <li>Scan your library to fetch metadata automatically</li>
                        <li>Mount USB drives or network shares in <strong>Admin ‚Üí Storage</strong></li>
                        <li>Manage Wi-Fi networks in <strong>Admin ‚Üí Network</strong></li>
                    </ul>
                </div>

                <div style="margin-top: 30px; text-align: center;">
                    <button onclick="closeWelcome()" class="primary" style="padding: 14px 40px; font-size: 1.05rem;">Let's Get Started! üéâ</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>
    <script src="js/app.js?v=1768131100"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('Service Worker registered!', reg))
                    .catch(err => console.error('Service Worker registration failed:', err));
            });
        }
    </script>
</body>
</html>
